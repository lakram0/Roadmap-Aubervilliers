<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parcours Photos ‚Äî Aubervilliers (Dark Data)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    /* --- PALETTE DARK MODE N√âON --- */
    :root {
      --bg-main: #0b1220;
      --bg-panel: #111a2e;
      --card-bg: #1a2639;
      --text-light: #e8eefc;
      --text-muted: #8b9bbd;
      --accent: #00d2ff; /* Cyan n√©on */
      --border-color: rgba(255,255,255,0.1);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-main);
      color: var(--text-light);
      height: 100vh;
      display: flex; flex-direction: column;
    }

    /* Header */
    header {
      padding: 15px 20px; background: var(--bg-panel);
      border-bottom: 1px solid var(--border-color);
      display: flex; justify-content: space-between; align-items: center;
    }
    header h1 { margin: 0; font-size: 1.2rem; font-weight: 600; }
    header .meta { font-size: 0.9rem; color: var(--accent); }

    /* Layout */
    .layout { display: flex; flex: 1; overflow: hidden; }

    /* Sidebar (Panneau lat√©ral) */
    .sidebar {
      width: 420px; /* Un peu plus large pour les m√©tadonn√©es */
      background: var(--bg-panel);
      border-right: 1px solid var(--border-color);
      overflow-y: auto; padding: 20px; flex-shrink: 0;
    }

    /* --- NOUVEAU DESIGN DES CARTES (PLUS RICHES) --- */
    .spot-card {
      background: var(--card-bg); border-radius: 12px; padding: 15px;
      margin-bottom: 20px; display: flex; gap: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease; cursor: pointer; position: relative;
    }
    .spot-card:hover {
      transform: translateY(-3px); border-color: var(--accent);
      box-shadow: 0 0 15px rgba(0, 210, 255, 0.2);
    }
    /* Indicateur visuel de s√©lection */
    .spot-card.active-card {
        border: 2px solid var(--accent);
        background: #1f2e45;
    }

    .spot-thumb {
      width: 90px; height: 90px; border-radius: 10px; object-fit: cover;
      flex-shrink: 0; border: 2px solid rgba(0, 210, 255, 0.3);
    }

    .spot-content { flex: 1; display: flex; flex-direction: column; }

    .spot-badges { display: flex; gap: 8px; margin-bottom: 8px; }
    .badge {
      background: rgba(0, 210, 255, 0.15); color: var(--accent);
      font-size: 0.7rem; font-weight: 700; padding: 4px 8px;
      border-radius: 4px; text-transform: uppercase;
    }

    .spot-content h3 {
      margin: 0 0 10px 0; font-size: 1.1rem; color: var(--text-light);
    }

    /* --- NOUVELLE SECTION METADATA --- */
    .meta-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        font-size: 0.8rem; color: var(--text-muted);
        background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px;
    }
    .meta-item { display: flex; align-items: center; gap: 6px; }
    .meta-icon { opacity: 0.7; }
    .color-sample {
      width: 12px; height: 12px; border-radius: 50%; display: inline-block;
      border: 1px solid rgba(255,255,255,0.3);
    }

    /* Carte (Map) */
    #map { flex: 1; height: 100%; background: #0b1220; }

    /* Popups style sombre */
    .leaflet-popup-content-wrapper { background: var(--bg-panel); color: var(--text-light); border: 1px solid var(--accent); }
    .leaflet-popup-tip { background: var(--bg-panel); border-top: 1px solid var(--accent); }
    .popup-img { width: 100%; border-radius: 6px; margin-bottom: 8px; border: 1px solid var(--border-color); }

    @media (max-width: 768px) {
      .layout { flex-direction: column-reverse; }
      .sidebar { width: 100%; height: 50vh; }
      #map { height: 50vh; }
    }
  </style>
</head>
<body>

  <header>
    <h1>Parcours Aubervilliers</h1>
    <div class="meta">Donn√©es & Visualisation N√©on</div>
  </header>

  <div class="layout">
    <aside class="sidebar" id="cards-container">
      </aside>
    <main id="map"></main>
  </div>

<script>
  // --- 1. DONN√âES COMPL√àTES (Ajout des dimensions 'dims') ---
  const data = [
        { id: 1, file: "images/photo04.jpg", title: "Humath√®que (Ext.)", coords: [48.9105, 2.3660], time: "10:15", dims: "3024x4032", sentiment: "Moderne", color: "#3498DB" },
        { id: 2, file: "images/photo02.jpg", title: "MSH Paris Nord", coords: [48.9112, 2.3655], time: "10:20", dims: "3024x4032", sentiment: "Graphique", color: "#A93226" },
        { id: 3, file: "images/photo03.jpg", title: "All√©e Platanes", coords: [48.9115, 2.3670], time: "10:25", dims: "3024x4032", sentiment: "Urbain", color: "#F1C40F" },
        { id: 4, file: "images/photo10.jpg", title: "Contre-jour V√©g√©tal", coords: [48.9120, 2.3680], time: "10:30", dims: "3024x4032", sentiment: "Espoir", color: "#F39C12" },
        { id: 5, file: "images/photo17.jpg", title: "Rayons & B√¢timent", coords: [48.9121, 2.3681], time: "10:35", dims: "3024x4032", sentiment: "√âblouissant", color: "#FFFFFF" },
        { id: 6, file: "images/photo09.jpg", title: "Canop√©e Jaune", coords: [48.9122, 2.3682], time: "10:40", dims: "3024x4032", sentiment: "Chaud", color: "#D35400" },
        { id: 7, file: "images/photo12.jpg", title: "Fresque Murale", coords: [48.9124, 2.3683], time: "10:45", dims: "3024x4032", sentiment: "Artistique", color: "#8E44AD" },
        { id: 8, file: "images/photo05.jpg", title: "Parc (Ombres)", coords: [48.9125, 2.3685], time: "10:50", dims: "3024x4032", sentiment: "Paisible", color: "#1E8449" },
        { id: 9, file: "images/photo08.jpg", title: "Grand Arbre", coords: [48.9126, 2.3688], time: "10:55", dims: "3024x4032", sentiment: "Nature", color: "#145A32" },
        { id: 10, file: "images/photo06.jpg", title: "Statue Taureau", coords: [48.9128, 2.3690], time: "11:00", dims: "3024x4032", sentiment: "Curieux", color: "#7D6608" },
        { id: 11, file: "images/photo07.jpg", title: "Plaque 'Camille'", coords: [48.9128, 2.3691], time: "11:05", dims: "3024x4032", sentiment: "D√©tail", color: "#95A5A6" },
        { id: 12, file: "images/photo11.jpg", title: "Campus Vert", coords: [48.9130, 2.3695], time: "11:10", dims: "3024x4032", sentiment: "Ouvert", color: "#2ECC71" },
        { id: 13, file: "images/photo16.jpg", title: "Esplanade", coords: [48.9132, 2.3698], time: "11:15", dims: "3024x4032", sentiment: "Vaste", color: "#5DADE2" },
        { id: 14, file: "images/photo01.jpg", title: "Vieux Aubervilliers", coords: [48.9135, 2.3700], time: "11:25", dims: "3024x4032", sentiment: "Historique", color: "#A93226" },
        { id: 15, file: "images/photo14.jpg", title: "Hall Entr√©e", coords: [48.9140, 2.3665], time: "11:35", dims: "3024x4032", sentiment: "Accueil", color: "#BDC3C7" },
        { id: 16, file: "images/photo13.jpg", title: "Atrium (Bas)", coords: [48.9142, 2.3665], time: "11:40", dims: "3024x4032", sentiment: "A√©rien", color: "#AED6F1" },
        { id: 17, file: "images/photo15.jpg", title: "Atrium (Haut)", coords: [48.9145, 2.3665], time: "11:45", dims: "3024x4032", sentiment: "Complexe", color: "#5D6D7E" }
  ];

  // --- 2. INITIALISATION CARTE (FOND SOMBRE) ---
  const map = L.map('map').setView([48.9125, 2.3680], 16);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OSM & CARTO', subdomains: 'abcd', maxZoom: 20
  }).addTo(map);

  // Objet pour stocker les r√©f√©rences aux marqueurs Leaflet par leur ID
  const markersById = {};

  // --- 3. G√âN√âRATION DU CONTENU ---
  const cardsContainer = document.getElementById('cards-container');
  const pathCoords = [];

  data.forEach(item => {
      // A. G√©n√©rer la CARTE HTML (Avec m√©tadonn√©es √©tendues)
      // Note le nouveau 'onclick' qui appelle openSpotOnMap(id)
      const html = `
          <div class="spot-card" id="card-${item.id}" onclick="openSpotOnMap(${item.id})">
              <img src="${item.file}" alt="${item.title}" class="spot-thumb" onerror="this.src='https://placehold.co/80?text=IMG'">
              <div class="spot-content">
                  <div class="spot-badges">
                      <span class="badge">#${item.id}</span>
                      <span class="badge">${item.time}</span>
                  </div>
                  <h3>${item.title}</h3>
                  
                  <div class="meta-grid">
                      <div class="meta-item">
                          <span class="meta-icon">‚ù§Ô∏è</span> ${item.sentiment}
                      </div>
                       <div class="meta-item">
                          <span class="meta-icon">üìê</span> ${item.dims}
                      </div>
                      <div class="meta-item" style="grid-column: span 2;">
                          <span class="meta-icon">üé®</span> 
                          <span class="color-sample" style="background:${item.color}; box-shadow: 0 0 6px ${item.color}"></span>
                          ${item.color}
                      </div>
                  </div>

              </div>
          </div>
      `;
      cardsContainer.innerHTML += html;

      // B. Ajouter le marqueur et STOCKER SA R√âF√âRENCE
      const marker = L.circleMarker(item.coords, {
          color: '#00d2ff', weight: 2, fillColor: item.color, fillOpacity: 0.7, radius: 8
      }).addTo(map);

      marker.bindPopup(`
        <img src="${item.file}" class="popup-img">
        <b>${item.title}</b><br>
        Sentiment: ${item.sentiment}
      `);
      
      // IMPORTANT : On sauvegarde le marqueur dans notre objet de r√©f√©rence
      markersById[item.id] = marker;
      pathCoords.push(item.coords);
  });

  // C. Tracer le chemin
  L.polyline(pathCoords, {
      color: '#00d2ff', weight: 3, opacity: 0.8, dashArray: '5, 10'
  }).addTo(map);

  // --- 4. FONCTION D'INTERACTION (CLIC CARTE -> OUVRE POPUP) ---
  let currentActiveCard = null;

  function openSpotOnMap(id) {
      const marker = markersById[id]; // On retrouve le bon marqueur gr√¢ce √† l'ID
      if (marker) {
          // 1. Centrer la carte sur le marqueur
          map.setView(marker.getLatLng(), 18, { animate: true, duration: 1 });
          
          // 2. OUVRIR LA POPUP (ce qui affiche la photo sur la carte)
          marker.openPopup();

          // 3. Gestion visuelle de la carte active dans le panneau lat√©ral
          if (currentActiveCard) {
             currentActiveCard.classList.remove('active-card');
          }
          const newActiveCard = document.getElementById(`card-${id}`);
          if (newActiveCard) {
              newActiveCard.classList.add('active-card');
              currentActiveCard = newActiveCard;
          }
      }
  }

  // Ajuster la vue au chargement
  map.fitBounds(pathCoords, { padding: [50, 50] });

</script>
</body>
</html>
